---
- name: Init phase block
  tags: init
  block:
  - name: Initialize phase - set facts for files_list_dict
    set_fact:
      files_list_dict: {}

  - name: Initialize phase - set fact for host files_list
    set_fact:
      files_list_dict: "{{ files_list_dict | combine( { inventory_hostname: [] } ) }}"

  - name: Initialize phase - setting source manifests path
    set_fact:
      manifest_src_dir: "{{ kube_manifests_dir }}"
    when: (backup is defined) and (backup | bool)

  - name: Initialize phase - setting source manifests path
    set_fact:
      manifest_src_dir: "{{ kube_manifests_backup_dir }}"
    when: (startcp is defined) and (startcp | bool)

  - name: Initialize phase - collect kubernetes static manifests files
    find:
      path: "{{ manifest_src_dir }}"
    register: manifests

  - name: Initialize phase - append files to files_list fact
    set_fact:
      files_list_dict: "{{ files_list_dict | combine( { inventory_hostname: files_list_dict[inventory_hostname] + [item.path] }) }}"
    loop: "{{ manifests.files }}"
    loop_control:
      label: "{{ item.path }}"